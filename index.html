<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TWD97 åŸå§‹åº§æ¨™å¥—ç–Šåœ–</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  html, body, #map { height: 100%; margin: 0; }
</style>
</head>
<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  // åˆå§‹åŒ–åœ°åœ–
  var map = L.map('map');

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // è¼‰å…¥æ—ç­åœ° GeoJSON
  fetch('forest_blocks.geojson')
    .then(res => res.json())
    .then(linbanData => {
      L.geoJSON(linbanData, {
        style: { color: "blue", weight: 1, fillOpacity: 0.1 },
        interactive: false
      }).addTo(map);
    });

  // ä½”ç”¨é»ä½è³‡æ–™
  var data = {
    "type": "FeatureCollection",
    "features": [
      {"type":"Feature","properties":{"id":1,"x":231661,"y":2426362,"zone":121,"ä½”ç”¨äºº":"å¸†èˆ¹çŸ³è¬è–å®®","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.8224668,21.9349188]}},
      {"type":"Feature","properties":{"id":2,"x":232680,"y":2425269,"zone":121,"ä½”ç”¨äºº":"é¦™è•‰ç£é®æµ·å®®","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.8323429,21.9250573]}},
      {"type":"Feature","properties":{"id":3,"x":235005,"y":2423980,"zone":121,"ä½”ç”¨äºº":"å‘å…§ç¦å®‰å®®","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.8548606,21.9134365]}},
      {"type":"Feature","properties":{"id":4,"x":233577,"y":2424327,"zone":121,"ä½”ç”¨äºº":"åŸ”é ‚è·¯åœŸåœ°å…¬å»Ÿ","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.8410353,21.9165578]}},
      {"type":"Feature","properties":{"id":5,"x":230812,"y":2433364,"zone":121,"ä½”ç”¨äºº":"37æ—ç­å»Ÿå®‡","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.8141657,21.9981507]}},
      {"type":"Feature","properties":{"id":6,"x":234109,"y":2437723,"zone":121,"ä½”ç”¨äºº":"æ¬–ä»è·¯å»Ÿå®‡","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.8460543,22.0375534]}},
      {"type":"Feature","properties":{"id":7,"x":238678,"y":2443091,"zone":121,"ä½”ç”¨äºº":"å—ä»æ¼æ¸¯å»Ÿå®‡","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.8902795,22.0860716]}},
      {"type":"Feature","properties":{"id":8,"x":225207,"y":2431708,"zone":121,"ä½”ç”¨äºº":"å³æ†æ…¶ã€å³æ˜¥ä¿¡ã€å³è²´é †ç­‰äºº","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.7599072,21.9831236]}},
      {"type":"Feature","properties":{"id":9,"x":225264,"y":2431793,"zone":121,"ä½”ç”¨äºº":"é™³æ–‡å¯Œã€é™³è³¢è«’","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.7604579,21.9838921]}},
      {"type":"Feature","properties":{"id":10,"x":225185,"y":2431713,"zone":121,"ä½”ç”¨äºº":"é¾”æ¦®å¤(å¢“ç¢‘æ‰€è¼‰é¾”æˆæ)","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.7596941,21.9831684]}},
      {"type":"Feature","properties":{"id":11,"x":225258,"y":2431788,"zone":121,"ä½”ç”¨äºº":"é™³é€²ä¾†ã€é™³é€²ç‰","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.7603999,21.9838468]}},
      {"type":"Feature","properties":{"id":12,"x":228085,"y":2427680,"zone":121,"ä½”ç”¨äºº":"æ†æ˜¥é®å…¬æ‰€","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.7878314,21.9467818]}},
      {"type":"Feature","properties":{"id":13,"x":233520,"y":2431763,"zone":121,"ä½”ç”¨äºº":"æ½˜æè‚‰","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.8404086,21.9837183]}},
      {"type":"Feature","properties":{"id":14,"x":236982,"y":2445365,"zone":121,"ä½”ç”¨äºº":"ä¸è©³","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.8738255,22.1065979]}},
      {"type":"Feature","properties":{"id":30,"x":237862,"y":2445921,"zone":121,"ä½”ç”¨äºº":"æ½˜è¬è²´","å ç”¨å‹æ…‹":"æˆ¿èˆå·¥å¯®"},"geometry":{"type":"Point","coordinates":[120.8823505,22.1116259]}},
      {"type":"Feature","properties":{"id":31,"x":237640,"y":2446014,"zone":121,"ä½”ç”¨äºº":"æ½˜ç‰è•Š","å ç”¨å‹æ…‹":"æˆ¿èˆå·¥å¯®"},"geometry":{"type":"Point","coordinates":[120.880198,22.1124643]}},
      {"type":"Feature","properties":{"id":32,"x":237635,"y":2446028,"zone":121,"ä½”ç”¨äºº":"å³æ•é›²ï¼ˆæœ±å’¨æŸ”ï¼‰","å ç”¨å‹æ…‹":"æˆ¿èˆå·¥å¯®"},"geometry":{"type":"Point","coordinates":[120.8801495,22.1125907]}},
      {"type":"Feature","properties":{"id":33,"x":219165.35,"y":2448990.303,"zone":121,"ä½”ç”¨äºº":"æ—èŒ‚ç››(æ»¿è±æ¼å ´)","å ç”¨å‹æ…‹":"æ°´æ± "},"geometry":{"type":"Point","coordinates":[120.7010731,22.1391155]}},
      {"type":"Feature","properties":{"id":34,"x":219202.09,"y":2448916,"zone":121,"ä½”ç”¨äºº":"æ—èŒ‚ç››(æ»¿è±æ¼å ´)","å ç”¨å‹æ…‹":"æ°´æ± "},"geometry":{"type":"Point","coordinates":[120.7014307,22.1384451]}},
      {"type":"Feature","properties":{"id":35,"x":218284.32,"y":2437497.25,"zone":121,"ä½”ç”¨äºº":"è¨±ç¯€ä¸€(è§€éŸ³å·–)","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.6927567,22.0352986]}},
      {"type":"Feature","properties":{"id":36,"x":218272.41,"y":2437464.06,"zone":121,"ä½”ç”¨äºº":"è¨±ç¯€ä¸€(è§€éŸ³å·–)","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.692642,22.0349986]}},
      {"type":"Feature","properties":{"id":37,"x":220445,"y":2431710,"zone":121,"ä½”ç”¨äºº":"é‚µä¸ç¦(æ°´ä»™å°Šç‹)","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.7137929,21.9830677]}},
      {"type":"Feature","properties":{"id":38,"x":222155.44,"y":2424730.871,"zone":121,"ä½”ç”¨äºº":"å¼µå—å’Œ","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.7304753,21.9200615]}},
      {"type":"Feature","properties":{"id":39,"x":238478.15,"y":2454842.426,"zone":121,"ä½”ç”¨äºº":"ä¸è©³","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.8882591,22.1922054]}},
      {"type":"Feature","properties":{"id":40,"x":219631.12,"y":2441754.426,"zone":121,"ä½”ç”¨äºº":"ä¸è©³","å ç”¨å‹æ…‹":"è¾²ä½œç‰©å¢¾æ®–"},"geometry":{"type":"Point","coordinates":[120.705724,22.073772]}},
      {"type":"Feature","properties":{"id":41,"x":219720.63,"y":2441598.63,"zone":121,"ä½”ç”¨äºº":"ä¸è©³","å ç”¨å‹æ…‹":"è¾²ä½œç‰©å¢¾æ®–"},"geometry":{"type":"Point","coordinates":[120.7065943,22.0723665]}},
      {"type":"Feature","properties":{"id":42,"x":220179,"y":2432133,"zone":121,"ä½”ç”¨äºº":"ä¸è©³","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.7112092,21.9868836]}}
    ]
  };

  // åŠ å…¥é»ä½è³‡æ–™
  var layer = L.geoJSON(data, {
    onEachFeature: function(feature, layer) {
      var p = feature.properties;
      layer.bindPopup(
        "ID: " + p.id + "<br>" +
        "TWD97: " + p.x + "," + p.y + "<br>" +
        "Zone: " + p.zone + "<br>" +
        "ä½”ç”¨äºº: " + (p["ä½”ç”¨äºº"] || "") + "<br>" +
        "å ç”¨å‹æ…‹: " + (p["å ç”¨å‹æ…‹"] || "")
      );
    }
  }).addTo(map);

  // è‡ªå‹•ç¸®æ”¾åˆ°é»ä½ç¯„åœ
  map.fitBounds(layer.getBounds().pad(0.2));

  // GPS å³æ™‚å®šä½
  var userMarker = null;
  map.locate({watch: true, setView: true, maxZoom: 16});

  map.on('locationfound', function(e) {
    if (userMarker) {
      userMarker.setLatLng(e.latlng);
    } else {
      userMarker = L.marker(e.latlng).addTo(map).bindPopup("ğŸ“ ä½ çš„ä½ç½®");
    }
  });

  map.on('locationerror', function(e) {
    console.warn("ç„¡æ³•å–å¾— GPS ä½ç½®ï¼š" + e.message);
  });
</script>
</body>
</html>
