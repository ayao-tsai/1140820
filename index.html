<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TWD97 åŸå§‹åº§æ¨™å¥—ç–Šåœ– - å…¨é»ä½ç¤ºç¯„</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  html, body, #map { height: 100%; margin: 0; }
  .legend { background:white; padding:6px; line-height:1.4; font-size:14px;}
  .legend div { margin-bottom:3px;}
  .legend span { display:inline-block; width:12px; height:12px; margin-right:6px; }
</style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
var map = L.map('map', { center:[21.95,120.83], zoom:12 });

// --- åº•åœ– ---
var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:19, attribution:'&copy; OpenStreetMap contributors' }).addTo(map);
var googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', { maxZoom:20, subdomains:['mt0','mt1','mt2','mt3'], attribution:'Â© Google' });
var topo = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', { maxZoom:17, attribution:'Map data: &copy; OpenTopoMap, &copy; OpenStreetMap contributors' });

L.control.layers({ "OpenStreetMap":osm, "Google è¡›æ˜Ÿ":googleSat, "OpenTopoMap":topo }).addTo(map);

// --- è¼‰å…¥æ—ç­åœ° GeoJSON ---
fetch('forest_blocks.geojson')
  .then(res => res.json())
  .then(linbanData => {
    L.geoJSON(linbanData, {
      style: { color:"blue", weight:1, fillOpacity:0.1 },
      interactive:false
    }).addTo(map);
  })
  .catch(err=>console.error('GeoJSON è¼‰å…¥éŒ¯èª¤', err));

// --- ä½”ç”¨é»ä½è³‡æ–™ ---
var data = {
  "type":"FeatureCollection",
  "features":[
    {"type":"Feature","properties":{"id":1,"x":231661.0,"y":2426362.0,"zone":121,"ä½”ç”¨äºº":"å¸†èˆ¹çŸ³è¬è–å®®","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.82246680021727,21.934918788224657]}},
    {"type":"Feature","properties":{"id":2,"x":232680.0,"y":2425269.0,"zone":121,"ä½”ç”¨äºº":"é¦™è•‰ç£é®æµ·å®®","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.83234289935699,21.925057283544593]}},
    {"type":"Feature","properties":{"id":3,"x":235005.0,"y":2423980.0,"zone":121,"ä½”ç”¨äºº":"å‘å…§ç¦å®‰å®®","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.85486057201072,21.913436546875108]}},
    {"type":"Feature","properties":{"id":4,"x":233577.0,"y":2424327.0,"zone":121,"ä½”ç”¨äºº":"åŸ”é ‚è·¯åœŸåœ°å…¬å»Ÿ","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.84103525203702,21.916557847753822]}},
    {"type":"Feature","properties":{"id":5,"x":230812.0,"y":2433364.0,"zone":121,"ä½”ç”¨äºº":"37æ—ç­å»Ÿå®‡","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.81416573309994,21.9981506946634]}},
    {"type":"Feature","properties":{"id":6,"x":234109.0,"y":2437723.0,"zone":121,"ä½”ç”¨äºº":"æ¬–ä»è·¯å»Ÿå®‡","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.84605429659877,22.03755340098851]}},
    {"type":"Feature","properties":{"id":7,"x":238678.0,"y":2443091.0,"zone":121,"ä½”ç”¨äºº":"å—ä»æ¼æ¸¯å»Ÿå®‡","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.89027947659291,22.08607157701605]}},
    {"type":"Feature","properties":{"id":8,"x":225207.0,"y":2431708.0,"zone":121,"ä½”ç”¨äºº":"å³æ†æ…¶ã€å³æ˜¥ä¿¡ã€å³è²´é †ç­‰äºº","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.7599072387372,21.983123568501725]}},
    {"type":"Feature","properties":{"id":9,"x":225264.0,"y":2431793.0,"zone":121,"ä½”ç”¨äºº":"é™³æ–‡å¯Œã€é™³è³¢è«’","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.76045792872542,21.983892077777107]}},
    {"type":"Feature","properties":{"id":10,"x":225185.0,"y":2431713.0,"zone":121,"ä½”ç”¨äºº":"é¾”æ¦®å¤(å¢“ç¢‘æ‰€è¼‰é¾”æˆæ)","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.75969411850045,21.983168415658845]}},
    {"type":"Feature","properties":{"id":11,"x":225258.0,"y":2431788.0,"zone":121,"ä½”ç”¨äºº":"é™³é€²ä¾†ã€é™³é€²ç‰","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.76039990123958,21.983846833976514]}},
    {"type":"Feature","properties":{"id":12,"x":228085.0,"y":2427680.0,"zone":121,"ä½”ç”¨äºº":"æ†æ˜¥é®å…¬æ‰€","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.78783135511246,21.946781750838234]}},
    {"type":"Feature","properties":{"id":13,"x":233520.0,"y":2431763.0,"zone":121,"ä½”ç”¨äºº":"æ½˜æè‚‰","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.84040858808036,21.983718349532523]}},
    {"type":"Feature","properties":{"id":14,"x":236982.0,"y":2445365.0,"zone":121,"ä½”ç”¨äºº":"ä¸è©³","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.8738254606261,22.106597873233458]}},
    {"type":"Feature","properties":{"id":30,"x":237862.0,"y":2445921.0,"zone":121,"ä½”ç”¨äºº":"æ½˜è¬è²´","å ç”¨å‹æ…‹":"æˆ¿èˆå·¥å¯®"},"geometry":{"type":"Point","coordinates":[120.8823505176882,22.111625872423318]}},
    {"type":"Feature","properties":{"id":31,"x":237640.0,"y":2446014.0,"zone":121,"ä½”ç”¨äºº":"æ½˜ç‰è•Š","å ç”¨å‹æ…‹":"æˆ¿èˆå·¥å¯®"},"geometry":{"type":"Point","coordinates":[120.88019804170717,22.11246425790487]}},
    {"type":"Feature","properties":{"id":32,"x":237635.0,"y":2446028.0,"zone":121,"ä½”ç”¨äºº":"å³æ•é›²ï¼ˆæœ±å’¨æŸ”ï¼‰","å ç”¨å‹æ…‹":"æˆ¿èˆå·¥å¯®"},"geometry":{"type":"Point","coordinates":[120.88014947136364,22.112590666339]}},
    {"type":"Feature","properties":{"id":33,"x":219165.35,"y":2448990.303,"zone":121,"ä½”ç”¨äºº":"æ—èŒ‚ç››(æ»¿è±æ¼å ´)","å ç”¨å‹æ…‹":"æ°´æ± "},"geometry":{"type":"Point","coordinates":[120.70107313999323,22.139115541040578]}},
    {"type":"Feature","properties":{"id":34,"x":219202.09,"y":2448916.0,"zone":121,"ä½”ç”¨äºº":"æ—èŒ‚ç››(æ»¿è±æ¼å ´)","å ç”¨å‹æ…‹":"æ°´æ± "},"geometry":{"type":"Point","coordinates":[120.7014307272043,22.138445119520583]}},
    {"type":"Feature","properties":{"id":35,"x":218284.32,"y":2437497.25,"zone":121,"ä½”ç”¨äºº":"è¨±ç¯€ä¸€(è§€éŸ³å·–)","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.69275673872767,22.035298665285968]}},
    {"type":"Feature","properties":{"id":36,"x":218272.41,"y":2437464.06,"zone":121,"ä½”ç”¨äºº":"è¨±ç¯€ä¸€(è§€éŸ³å·–)","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.69264200986714,22.03499868711318]}},
    {"type":"Feature","properties":{"id":37,"x":220445.0,"y":2431710.0,"zone":121,"ä½”ç”¨äºº":"é‚µä¸ç¦(æ°´ä»™å°Šç‹)","å ç”¨å‹æ…‹":"å¯ºå»Ÿ"},"geometry":{"type":"Point","coordinates":[120.71379290748393,21.98306768777447]}},
    {"type":"Feature","properties":{"id":38,"x":222155.44,"y":2424730.871,"zone":121,"ä½”ç”¨äºº":"å¼µå—å’Œ","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.73047530807268,21.920061572089466]}},
    {"type":"Feature","properties":{"id":39,"x":238478.15,"y":2454842.426,"zone":121,"ä½”ç”¨äºº":"ä¸è©³","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.8882590510578,22.19220546002869]}},
    {"type":"Feature","properties":{"id":40,"x":219631.12,"y":2441754.426,"zone":121,"ä½”ç”¨äºº":"ä¸è©³","å ç”¨å‹æ…‹":"è¾²ä½œç‰©å¢¾æ®–"},"geometry":{"type":"Point","coordinates":[120.70572409286015,22.073772058104606]}},
    {"type":"Feature","properties":{"id":41,"x":219720.63,"y":2441598.63,"zone":121,"ä½”ç”¨äºº":"ä¸è©³","å ç”¨å‹æ…‹":"è¾²ä½œç‰©å¢¾æ®–"},"geometry":{"type":"Point","coordinates":[120.70659434552873,22.072366520058555]}},
    {"type":"Feature","properties":{"id":42,"x":220179.0,"y":2432133.0,"zone":121,"ä½”ç”¨äºº":"ä¸è©³","å ç”¨å‹æ…‹":"å¢³å¢“"},"geometry":{"type":"Point","coordinates":[120.71120929074316,21.98688360901871]}}
  ]
};

// --- é¡è‰²è¨­å®š ---
function getColor(type){
  switch(type){
    case "å¯ºå»Ÿ": return "red";
    case "å¢³å¢“": return "black";
    case "æ°´æ± ": return "blue";
    case "æˆ¿èˆå·¥å¯®": return "green";
    case "è¾²ä½œç‰©å¢¾æ®–": return "orange";
    default: return "gray";
  }
}

// --- åŠ å…¥é»ä½ ---
var layer = L.geoJSON(data, {
  pointToLayer:function(feature,latlng){
    return L.circleMarker(latlng,{ radius:5, fillColor:getColor(feature.properties["å ç”¨å‹æ…‹"]), color:"#000", weight:1, fillOpacity:0.8 });
  },
  onEachFeature:function(feature,layer){
    var p = feature.properties;
    layer.bindPopup(
      "ID: "+p.id+"<br>"+
      "TWD97: "+p.x+","+p.y+"<br>"+
      "Zone: "+p.zone+"<br>"+
      "ä½”ç”¨äºº: "+(p["ä½”ç”¨äºº"]||"") +"<br>"+
      "å ç”¨å‹æ…‹: "+(p["å ç”¨å‹æ…‹"]||"")
    );
  }
}).addTo(map);

// --- åœ°åœ–ç¸®æ”¾åˆ°é»ä½ ---
map.fitBounds(layer.getBounds().pad(0.2));

// --- GPS å®šä½ ---
var userMarker = null;
map.locate({watch:true, setView:true, maxZoom:16});
map.on('locationfound', function(e){
  if(userMarker) userMarker.setLatLng(e.latlng);
  else userMarker = L.marker(e.latlng, {
    icon:L.icon({ iconUrl:'https://cdn-icons-png.flaticon.com/512/64/64113.png', iconSize:[32,32], iconAnchor:[16,32] })
  }).addTo(map).bindPopup("ğŸ“ ä½ çš„ä½ç½®");
});
map.on('locationerror', function(e){ alert("âš ï¸ ç„¡æ³•å–å¾— GPSï¼š" + e.message); });

// --- åœ–ä¾‹ ---
var legend = L.control({position:"bottomright"});
legend.onAdd = function(map){
  var div = L.DomUtil.create("div","legend");
  var types = ["å¯ºå»Ÿ","å¢³å¢“","æ°´æ± ","æˆ¿èˆå·¥å¯®","è¾²ä½œç‰©å¢¾æ®–"];
  types.forEach(function(t){ div.innerHTML += '<div><span style="background:'+getColor(t)+'"></span>'+t+'</div>'; });
  return div;
};
legend.addTo(map);

</script>
</body>
</html>
